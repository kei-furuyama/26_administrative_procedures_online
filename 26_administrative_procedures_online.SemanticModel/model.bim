{
  "compatibilityLevel": 1601,
  "model": {
    "annotations": [
      {
        "name": "__PBI_TimeIntelligenceEnabled",
        "value": "0"
      },
      {
        "name": "PBI_QueryOrder",
        "value": "[\"オンライン化状況\"]"
      },
      {
        "name": "PBI_ProTooling",
        "value": "[\"DevMode\"]"
      }
    ],
    "culture": "ja-JP",
    "cultures": [
      {
        "name": "ja-JP",
        "linguisticMetadata": {
          "content": {
            "DynamicImprovement": "HighConfidence",
            "Language": "ja-JP",
            "Version": "1.0.0"
          },
          "contentType": "json"
        }
      }
    ],
    "dataAccessOptions": {
      "legacyRedirects": true,
      "returnErrorValuesAsNull": true
    },
    "defaultPowerBIDataSourceVersion": "powerBI_V3",
    "discourageImplicitMeasures": true,
    "tables": [
      {
        "name": "オンライン化状況",
        "annotations": [
          {
            "name": "PBI_ResultType",
            "value": "Table"
          }
        ],
        "columns": [
          {
            "name": "コード",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000001",
            "sourceColumn": "コード",
            "summarizeBy": "none"
          },
          {
            "name": "地域ブロック",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000002",
            "sourceColumn": "地域ブロック",
            "summarizeBy": "none"
          },
          {
            "name": "都道府県",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000003",
            "sourceColumn": "都道府県",
            "summarizeBy": "none"
          },
          {
            "name": "団体名",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000004",
            "sourceColumn": "団体名",
            "summarizeBy": "none"
          },
          {
            "name": "団体名フリガナ",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000005",
            "sourceColumn": "団体名フリガナ",
            "summarizeBy": "none"
          },
          {
            "name": "団体区分",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000006",
            "sourceColumn": "団体区分",
            "summarizeBy": "none"
          },
          {
            "name": "大カテゴリ",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000007",
            "sourceColumn": "大カテゴリ",
            "summarizeBy": "none"
          },
          {
            "name": "サブカテゴリ",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000008",
            "sourceColumn": "サブカテゴリ",
            "summarizeBy": "none"
          },
          {
            "name": "手続名",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-000000000009",
            "sourceColumn": "手続名",
            "summarizeBy": "none"
          },
          {
            "name": "重点手続",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-00000000000a",
            "sourceColumn": "重点手続",
            "summarizeBy": "none"
          },
          {
            "name": "オンライン化状況",
            "dataType": "string",
            "lineageTag": "a1000001-0001-0001-0001-00000000000b",
            "sourceColumn": "オンライン化状況",
            "summarizeBy": "none"
          },
          {
            "name": "その他手続数",
            "dataType": "int64",
            "formatString": "0",
            "lineageTag": "a1000001-0001-0001-0001-00000000000c",
            "sourceColumn": "その他手続数",
            "summarizeBy": "sum"
          }
        ],
        "lineageTag": "a1000001-0001-0001-0001-000000000000",
        "measures": [
          {
            "name": "オンライン対応数",
            "expression": [
              "-- オンライン化状況が空でない（対応済み or 該当なし）行数を返す",
              "COUNTROWS ( FILTER ( 'オンライン化状況', 'オンライン化状況'[オンライン化状況] <> \"\" ) )"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000001"
          },
          {
            "name": "該当なし数",
            "expression": [
              "-- ステータスが「ー」（該当なし）の行数を返す",
              "COUNTROWS ( FILTER ( 'オンライン化状況', 'オンライン化状況'[オンライン化状況] = \"ー\" ) )"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000002"
          },
          {
            "name": "未対応数",
            "expression": [
              "-- ステータスが空文字（未オンライン化）の行数を返す",
              "COUNTROWS ( FILTER ( 'オンライン化状況', 'オンライン化状況'[オンライン化状況] = \"\" ) )"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000003"
          },
          {
            "name": "オンライン化率",
            "expression": [
              "-- オンライン対応数 / (対応数 + 未対応数) の割合を返す",
              "VAR _Online = [オンライン対応数]",
              "VAR _Total = _Online + [未対応数]",
              "RETURN",
              "DIVIDE ( _Online, _Total )"
            ],
            "formatString": "0.0%",
            "lineageTag": "b1000001-0001-0001-0001-000000000004"
          },
          {
            "name": "手続数",
            "expression": [
              "-- 現在のフィルタコンテキスト内の手続行数を返す",
              "COUNTROWS ( 'オンライン化状況' )"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000005"
          },
          {
            "name": "自治体数",
            "expression": [
              "-- 現在のフィルタコンテキスト内の一意な自治体数を返す",
              "DISTINCTCOUNT ( 'オンライン化状況'[コード] )"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000006"
          },
          {
            "name": "子育て介護26手続完了自治体数",
            "expression": [
              "-- 子育て・介護26手続すべてオンライン化済みの自治体数を返す",
              "-- 未対応数が0の自治体を「完了」としてカウントする",
              "SUMX (",
              "    VALUES ( 'オンライン化状況'[コード] ),",
              "    VAR _NotOnline =",
              "        CALCULATE (",
              "            COUNTROWS ( 'オンライン化状況' ),",
              "            'オンライン化状況'[サブカテゴリ] IN { \"ア.子育て関係\", \"イ.介護関係\" },",
              "            'オンライン化状況'[オンライン化状況] = \"\"",
              "        )",
              "    RETURN",
              "        IF ( _NotOnline = 0, 1, 0 )",
              ")"
            ],
            "formatString": "#,##0",
            "lineageTag": "b1000001-0001-0001-0001-000000000007"
          },
          {
            "name": "子育て介護26手続完了率",
            "expression": [
              "-- 26手続完了自治体数 / 全自治体数 の割合を返す",
              "DIVIDE ( [子育て介護26手続完了自治体数], [自治体数] )"
            ],
            "formatString": "0.0%",
            "lineageTag": "b1000001-0001-0001-0001-000000000008"
          },
          {
            "name": "子育て介護オンライン化率_自治体別",
            "expression": [
              "-- 子育て・介護カテゴリに限定した自治体別オンライン化率を返す",
              "VAR _Online =",
              "    CALCULATE (",
              "        COUNTROWS ( 'オンライン化状況' ),",
              "        'オンライン化状況'[サブカテゴリ] IN { \"ア.子育て関係\", \"イ.介護関係\" },",
              "        'オンライン化状況'[オンライン化状況] <> \"\"",
              "    )",
              "VAR _Total =",
              "    CALCULATE (",
              "        COUNTROWS ( 'オンライン化状況' ),",
              "        'オンライン化状況'[サブカテゴリ] IN { \"ア.子育て関係\", \"イ.介護関係\" }",
              "    )",
              "RETURN",
              "DIVIDE ( _Online, _Total )"
            ],
            "formatString": "0%",
            "lineageTag": "b1000001-0001-0001-0001-000000000009"
          },
          {
            "name": "都道府県ラベル",
            "expression": [
              "-- 「都道府県名(完了数 / 全自治体数)」形式のラベル文字列を返す",
              "VAR _Pref = SELECTEDVALUE ( 'オンライン化状況'[都道府県] )",
              "VAR _Completed = [子育て介護26手続完了自治体数]",
              "VAR _Total = [自治体数]",
              "RETURN",
              "_Pref & \"(\" & _Completed & \" / \" & _Total & \")\""
            ],
            "lineageTag": "b1000001-0001-0001-0001-00000000000a"
          },
          {
            "name": "ステータス表示",
            "expression": [
              "-- 選択された行のオンライン化状況テキストを返す（複数行の場合は空文字）",
              "SELECTEDVALUE ( 'オンライン化状況'[オンライン化状況], \"\" )"
            ],
            "lineageTag": "b1000001-0001-0001-0001-00000000000b"
          },
          {
            "name": "ステータスコード",
            "expression": [
              "-- ステータスを数値コードに変換する（○/ー→1, 空→-1, その他→BLANK）",
              "-- 条件付き書式でのアイコン表示に使用",
              "SWITCH (",
              "    SELECTEDVALUE ( 'オンライン化状況'[オンライン化状況] ),",
              "    \"○\", 1,",
              "    \"ー\", 1,",
              "    \"\", -1,",
              "    BLANK ()",
              ")"
            ],
            "formatString": "0",
            "lineageTag": "b1000001-0001-0001-0001-00000000000c"
          }
        ],
        "partitions": [
          {
            "name": "オンライン化状況",
            "mode": "import",
            "source": {
              "expression": [
                "let",
                "    Source = Csv.Document(File.Contents(\"data_unpivoted.csv\"), [Delimiter=\",\", Columns=12, Encoding=65001, QuoteStyle=QuoteStyle.Csv]),",
                "    PromotedHeaders = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),",
                "    ChangedTypes = Table.TransformColumnTypes(PromotedHeaders, {",
                "        {\"コード\", type text},",
                "        {\"地域ブロック\", type text},",
                "        {\"都道府県\", type text},",
                "        {\"団体名\", type text},",
                "        {\"団体名フリガナ\", type text},",
                "        {\"団体区分\", type text},",
                "        {\"大カテゴリ\", type text},",
                "        {\"サブカテゴリ\", type text},",
                "        {\"手続名\", type text},",
                "        {\"重点手続\", type text},",
                "        {\"オンライン化状況\", type text},",
                "        {\"その他手続数\", Int64.Type}",
                "    })",
                "in",
                "    ChangedTypes"
              ],
              "type": "m"
            }
          }
        ]
      },
      {
        "name": "完了状況",
        "columns": [
          {
            "name": "ステータス",
            "dataType": "string",
            "isDataTypeInferred": true,
            "isNameInferred": true,
            "lineageTag": "c1000001-0001-0001-0001-000000000001",
            "sourceColumn": "[ステータス]",
            "sortByColumn": "順序",
            "summarizeBy": "none",
            "type": "calculatedTableColumn"
          },
          {
            "name": "順序",
            "dataType": "int64",
            "formatString": "0",
            "isDataTypeInferred": true,
            "isNameInferred": true,
            "lineageTag": "c1000001-0001-0001-0001-000000000002",
            "sourceColumn": "[順序]",
            "summarizeBy": "none",
            "type": "calculatedTableColumn"
          }
        ],
        "lineageTag": "c1000001-0001-0001-0001-000000000000",
        "measures": [
          {
            "name": "完了状況値",
            "expression": [
              "-- ドーナツチャート用: 「完了」なら完了自治体数、「未完了」なら残り自治体数を返す",
              "VAR _Status = SELECTEDVALUE ( '完了状況'[ステータス] )",
              "VAR _Completed = [子育て介護26手続完了自治体数]",
              "VAR _Total = [自治体数]",
              "RETURN",
              "SWITCH (",
              "    _Status,",
              "    \"完了\", _Completed,",
              "    \"未完了\", _Total - _Completed",
              ")"
            ],
            "formatString": "#,##0",
            "lineageTag": "d1000001-0001-0001-0001-000000000001"
          }
        ],
        "partitions": [
          {
            "name": "完了状況",
            "mode": "import",
            "source": {
              "expression": "UNION ( ROW ( \"ステータス\", \"完了\", \"順序\", 1 ), ROW ( \"ステータス\", \"未完了\", \"順序\", 2 ) )",
              "type": "calculated"
            }
          }
        ]
      }
    ]
  }
}
